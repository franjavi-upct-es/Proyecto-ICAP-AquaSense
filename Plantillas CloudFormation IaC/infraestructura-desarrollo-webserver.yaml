AWSTemplateFormatVersion: "2010-09-09"
Description: "AquaSenseCloud - Infraestructura de Desarrollo (EC2 para desarrollo y pruebas del webserver)"

# ============================================================================
# NOTA:
# La finalidad de esta plantilla es Ãºnicamente para el testeo del contenedor
# Docker localmente antes de subirlo a ECR.
#
# PROPÃ“SITO:
# - Proporciona un entorno controlado para desarrollar la aplicaciÃ³n.
# - Permite probar el contenedor Docker antes de desplegarlo en ECS.
# - Incluye todas las herramientas necesarias (Docker, AWS CLI, Python)
# ============================================================================

Parameters:
  ProjectPrefix:
    Type: String
    Default: proy
    Description: Prefijo para nombrar todos los recursos

  InstanceType:
    Type: String
    Default: t2.micro
    Description: Tipo de instancia EC2 (t2.micro elegible para free tier)
    AllowedValues:
      - t2.micro
      - t2.small
      - t2.medium

  KeyName:
    Type: AWS::EC2::KeyPair::KeyName
    Description: Key Pair existente para acceso SSH a la instancia

  MyIP:
    Type: String
    Description: Tu IP pÃºblica para acceso SSH (formato x.x.x.x/32)
    AllowedPattern: '^(\d{1,3}\.){3}\d{1,3}/32$'
    ConstraintDescription: Debe ser una IP vÃ¡lida en formato CIDR (ej 203.0.113.25/32)

Resources:
  # ============================================================================
  # SECURITY GROUP PARA EC2 DE DESARROLLO
  # ============================================================================

  DevelopmentSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupName: !Sub "${ProjectPrefix}-dev-sg"
      GroupDescription: Security group for development EC2 instance - Permite SSH y HTTP solo desde IP del desarrollador
      VpcId:
        Fn::ImportValue: !Sub "${ProjectPrefix}-VPCId"
      SecurityGroupIngress:
        # SSH desde tu IP especÃ­fica
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: !Ref MyIP
          Description: SSH desde IP del desarrollador
        # HTTP (puerto 80) para pruebas
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: !Ref MyIP
          Description: HTTP desde IP del desarrollador
        # Puerto 8080 para pruebas del contenedor Docker
        - IpProtocol: tcp
          FromPort: 8080
          ToPort: 8080
          CidrIp: !Ref MyIP
          Description: Puerto 8080 para contenedor Docker
        # Puerto 5000 (Flask default) para pruebas sin Docker
        - IpProtocol: tcp
          FromPort: 5000
          ToPort: 5000
          CidrIp: !Ref MyIP
          Description: Puerto 5000 para Flask en desarrollo
      SecurityGroupEgress:
        - IpProtocol: -1
          CidrIp: 0.0.0.0/0
          Description: Permitir todo el trÃ¡fico saliente (necesario para yum, docker pull, etc)
      Tags:
        - Key: Name
          Value: !Sub "${ProjectPrefix}-dev-sg"
        - Key: Purpose
          Value: Development
        - Key: Temporary
          Value: "true"

  # ============================================================================
  # IAM ROLE PARA EC2 (Permisos necesarios para desarrollo)
  # ============================================================================

  DevelopmentRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub "${ProjectPrefix}-dev-role"
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service: ec2.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        # Acceso completo a ECR para push/pull de imÃ¡genes
        - arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryFullAccess
        # Acceso a CloudWatch Logs para debugging
        - arn:aws:iam::aws:policy/CloudWatchLogsFullAccess
      Policies:
        # Acceso a DynamoDB para pruebas locales
        - PolicyName: DynamoDBAccessForTesting
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Effect: Allow
                Action:
                  - dynamodb:GetItem
                  - dynamodb:Query
                  - dynamodb:Scan
                  - dynamodb:PutItem
                  - dynamodb:UpdateItem
                  - dynamodb:DescribeTable
                Resource:
                  Fn::Sub:
                    - "arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${TableName}"
                    - TableName:
                        Fn::ImportValue: !Sub "${ProjectPrefix}-DynamoDBTable"
        # Acceso a CloudFormation para obtener outputs
        - PolicyName: CloudFormationReadAccess
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Effect: Allow
                Action:
                  - cloudformation:DescribeStacks
                  - cloudformation:ListStacks
                Resource: "*"

  DevelopmentInstanceProfile:
    Type: AWS::IAM::InstanceProfile
    Properties:
      InstanceProfileName: !Sub "${ProjectPrefix}-dev-profile"
      Roles:
        - !Ref DevelopmentRole

  # ============================================================================
  # EC2 INSTANCE PARA DESARROLLO
  # ============================================================================

  DevelopmentInstance:
    Type: AWS::EC2::Instance
    Properties:
      # Usar Amazon Linux 2023 (Ãºltima versiÃ³n)
      ImageId: !Sub "{{resolve:ssm:/aws/service/ami-amazon-linux-latest/al2023-ami-kernel-default-x86_64}}"
      InstanceType: !Ref InstanceType
      KeyName: !Ref KeyName
      IamInstanceProfile: !Ref DevelopmentInstanceProfile

      # ConfiguraciÃ³n de red
      NetworkInterfaces:
        - AssociatePublicIpAddress: true
          DeviceIndex: "0"
          GroupSet:
            - !Ref DevelopmentSecurityGroup
          SubnetId:
            Fn::ImportValue: !Sub "${ProjectPrefix}-PublicSubnet1"

      # ConfiguraciÃ³n de almacenamiento
      BlockDeviceMappings:
        - DeviceName: /dev/xvda
          Ebs:
            VolumeSize: 20
            VolumeType: gp3
            DeleteOnTermination: true

      # Script de inicializaciÃ³n (User Data)
      UserData:
        Fn::Base64: !Sub |
          #!/bin/bash

          # Redirigir todo el output a log
          exec > >(tee /var/log/user-data.log)
          exec 2>&1

          echo "=============================================================="
          echo "  CONFIGURACIÃ“N DE INSTANCIA DE DESARROLLO - AQUASENSECLOUD"
          echo "=============================================================="
          date
          echo ""

          # Actualizar sistema
          echo "[1/8] Actualizando sistema base..."
          yum update -y

          # Instalar Docker
          echo "[2/8] Instalando Docker..."
          yum install -y docker
          systemctl start docker
          systemctl enable docker
          usermod -a -G docker ec2-user

          # Instalar Docker Compose
          echo "[3/8] Instalando Docker Compose..."
          DOCKER_COMPOSE_VERSION="v2.23.0"
          curl -SL "https://github.com/docker/compose/releases/download/$DOCKER_COMPOSE_VERSION/docker-compose-linux-x86_64" -o /usr/local/bin/docker-compose
          chmod +x /usr/local/bin/docker-compose
          ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose

          # Instalar Git
          echo "[4/8] Instalando Git..."
          yum install -y git

          # Instalar Python 3.11 y herramientas
          echo "[5/8] Instalando Python 3.11..."
          yum install -y python3.11 python3.11-pip python3.11-devel
          ln -sf /usr/bin/python3.11 /usr/local/bin/python3
          ln -sf /usr/bin/pip3.11 /usr/local/bin/pip3

          # Instalar AWS CLI v2
          echo "[6/8] Instalando AWS CLI v2..."
          curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
          unzip -q awscliv2.zip
          ./aws/install
          rm -rf aws awscliv2.zip

          # Instalar herramientas Ãºtiles
          echo "[7/8] Instalando herramientas adicionales..."
          yum install -y vim nano htop curl wget jq unzip

          # Crear estructura de directorios
          echo "[8/8] Creando estructura de directorios..."
          mkdir -p /home/ec2-user/aquasense
          mkdir -p /home/ec2-user/aquasense/logs
          mkdir -p /home/ec2-user/aquasense/tests

          # Obtener informaciÃ³n de AWS
          REGION="${AWS::Region}"
          ACCOUNT_ID=$(aws sts get-caller-identity --query Account --output text)
          DYNAMODB_TABLE="${ProjectPrefix}-MarMenorData"

          # Crear archivo de variables de entorno
          cat > /home/ec2-user/aquasense/.env << EOFENV
          # Variables de entorno para AquaSenseCloud
          AWS_REGION=$REGION
          AWS_DEFAULT_REGION=$REGION
          DYNAMODB_TABLE=$DYNAMODB_TABLE
          ACCOUNT_ID=$ACCOUNT_ID
          PROJECT_PREFIX=${ProjectPrefix}
          PORT=8080
          DEBUG=False
          EOFENV

          # Crear Dockerfile de ejemplo
          cat > /home/ec2-user/aquasense/Dockerfile.example << 'EOFDOCKER'
          # Dockerfile de ejemplo para AquaSenseCloud
          FROM python:3.11-slim

          WORKDIR /app

          # Instalar curl para health check
          RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

          # Copiar requirements
          COPY requirements.txt .
          RUN pip install --no-cache-dir -r requirements.txt

          # Copiar aplicaciÃ³n
          COPY aquasense.py .

          # Crear usuario no-root
          RUN useradd -m -u 1000 appuser && chown -R appuser:appuser /app
          USER appuser

          EXPOSE 8080

          HEALTHCHECK --interval=30s --timeout=5s --start-period=10s --retries=3 \
              CMD curl -f http://localhost:8080/health || exit 1

          CMD ["gunicorn", "--bind", "0.0.0.0:8080", "--workers", "2", "aquasense:app"]
          EOFDOCKER

          # Crear archivo README con instrucciones detalladas
          cat > /home/ec2-user/README.txt << EOFREADME
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘                                                                      â•‘
          â•‘          INSTANCIA DE DESARROLLO - AQUASENSECLOUD                   â•‘
          â•‘          Infraestructuras para ComputaciÃ³n de Altas Prestaciones    â•‘
          â•‘                                                                      â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

          PROPÃ“SITO:
          Esta instancia estÃ¡ configurada para desarrollar y probar el contenedor
          Docker de la aplicaciÃ³n AquaSenseCloud antes de desplegarlo en ECS.

          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          HERRAMIENTAS INSTALADAS:
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

          âœ“ Docker 24.x             - ContenedorizaciÃ³n
          âœ“ Docker Compose 2.x      - OrquestaciÃ³n de contenedores
          âœ“ AWS CLI v2              - InteracciÃ³n con AWS
          âœ“ Python 3.11             - Runtime de la aplicaciÃ³n
          âœ“ Git                     - Control de versiones
          âœ“ Vim, Nano, Htop         - Herramientas de desarrollo

          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          DIRECTORIO DE TRABAJO:
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

          /home/ec2-user/aquasense/
          â”œâ”€â”€ .env                  # Variables de entorno
          â”œâ”€â”€ Dockerfile.example    # Ejemplo de Dockerfile
          â”œâ”€â”€ logs/                 # Logs de la aplicaciÃ³n
          â””â”€â”€ tests/                # Scripts de prueba

          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          PASOS PARA DESARROLLAR:
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

          1. COPIAR ARCHIVOS DE LA APLICACIÃ“N
             cd ~/aquasense
             
             Copiar aquÃ­:
             - aquasense.py          (cÃ³digo de la API)
             - requirements.txt      (dependencias)
             - Dockerfile            (definiciÃ³n de imagen)

          2. CONSTRUIR IMAGEN DOCKER
             docker build -t aquasense:dev .
             
             # Ver imagen creada
             docker images | grep aquasense

          3. PROBAR CONTENEDOR LOCALMENTE
             # Cargar variables de entorno
             set -a
             source .env
             set +a
             
             # Ejecutar contenedor
             docker run -d \
               --name aquasense-test \
               -p 8080:8080 \
               -e DYNAMODB_TABLE=\$DYNAMODB_TABLE \
               -e AWS_REGION=\$AWS_REGION \
               aquasense:dev
             
             # Ver logs
             docker logs -f aquasense-test

          4. PROBAR ENDPOINTS
             # Health check
             curl http://localhost:8080/health
             
             # Listar meses disponibles
             curl http://localhost:8080/months
             
             # Consultar temperatura
             curl "http://localhost:8080/temp?month=3&year=2017"
             
             # Consultar desviaciÃ³n
             curl "http://localhost:8080/sd?month=3&year=2017"
             
             # Consultar diferencia
             curl "http://localhost:8080/maxdiff?month=4&year=2017"

          5. DEPURAR SI HAY PROBLEMAS
             # Ver logs del contenedor
             docker logs aquasense-test
             
             # Entrar al contenedor
             docker exec -it aquasense-test /bin/bash
             
             # Detener contenedor
             docker stop aquasense-test
             docker rm aquasense-test

          6. SUBIR IMAGEN A ECR
             # Obtener variables
             source ~/aquasense/.env
             
             # Crear repositorio ECR (si no existe)
             aws ecr create-repository \
               --repository-name \${PROJECT_PREFIX}-api-repository \
               --region \$AWS_REGION
             
             # Autenticar con ECR
             aws ecr get-login-password --region \$AWS_REGION | \
               docker login --username AWS --password-stdin \
               \${ACCOUNT_ID}.dkr.ecr.\${AWS_REGION}.amazonaws.com
             
             # Tag de la imagen
             docker tag aquasense:dev \
               \${ACCOUNT_ID}.dkr.ecr.\${AWS_REGION}.amazonaws.com/\${PROJECT_PREFIX}-api-repository:latest
             
             # Push a ECR
             docker push \
               \${ACCOUNT_ID}.dkr.ecr.\${AWS_REGION}.amazonaws.com/\${PROJECT_PREFIX}-api-repository:latest
             
             # Verificar
             aws ecr describe-images \
               --repository-name \${PROJECT_PREFIX}-api-repository \
               --region \$AWS_REGION

          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          VARIABLES DE ENTORNO CONFIGURADAS:
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

          AWS_REGION:       $REGION
          DYNAMODB_TABLE:   $DYNAMODB_TABLE
          ACCOUNT_ID:       $ACCOUNT_ID
          PROJECT_PREFIX:   ${ProjectPrefix}

          Para cargar variables:
            source ~/aquasense/.env

          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          COMANDOS ÃšTILES:
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

          # Ver contenedores en ejecuciÃ³n
          docker ps

          # Ver todas las imÃ¡genes
          docker images

          # Limpiar contenedores detenidos
          docker container prune -f

          # Limpiar imÃ¡genes no usadas
          docker image prune -a -f

          # Ver uso de recursos
          docker stats

          # Logs del user-data
          sudo cat /var/log/user-data.log

          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          IMPORTANTE:
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

          âš ï¸  Esta instancia es TEMPORAL para desarrollo.
          âš ï¸  Una vez subida la imagen a ECR, ELIMINAR esta instancia.
          âš ï¸  Eliminar el stack de CloudFormation para evitar costos.

          Comando para eliminar:
            aws cloudformation delete-stack \
              --stack-name ${ProjectPrefix}-desarrollo-webserver \
              --region $REGION

          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          EOFREADME

          # Configurar bashrc del usuario
          cat >> /home/ec2-user/.bashrc << 'EOFBASHRC'

          # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          # AquaSenseCloud Development Environment
          # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

          # Cargar variables de entorno
          if [ -f ~/aquasense/.env ]; then
              set -a
              source ~/aquasense/.env
              set +a
          fi

          # Alias Ãºtiles
          alias aqua='cd ~/aquasense'
          alias dcup='docker-compose up -d'
          alias dcdown='docker-compose down'
          alias dlogs='docker logs -f'
          alias dps='docker ps'
          alias dimages='docker images'

          # Mostrar banner al login
          echo ""
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘     INSTANCIA DE DESARROLLO - AQUASENSECLOUD                 â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ðŸ“– Lee las instrucciones: cat ~/README.txt"
          echo "ðŸ“‚ Directorio de trabajo: cd ~/aquasense (o usa: aqua)"
          echo "ðŸ”§ Variables cargadas desde ~/aquasense/.env"
          echo ""
          EOFBASHRC

          # Establecer permisos correctos
          chown -R ec2-user:ec2-user /home/ec2-user/aquasense
          chown ec2-user:ec2-user /home/ec2-user/README.txt
          chmod 644 /home/ec2-user/aquasense/.env

          # Finalizar
          echo ""
          echo "=============================================================="
          echo "  âœ“ CONFIGURACIÃ“N COMPLETADA EXITOSAMENTE"
          echo "=============================================================="
          date
          echo ""
          echo "La instancia estÃ¡ lista para desarrollo."
          echo "ConÃ©ctate por SSH y lee ~/README.txt para instrucciones."
          echo ""

      Tags:
        - Key: Name
          Value: !Sub "${ProjectPrefix}-dev-instance"
        - Key: Purpose
          Value: Development
        - Key: Project
          Value: AquaSenseCloud
        - Key: Temporary
          Value: "true"
        - Key: AutoDelete
          Value: "true"

# ============================================================================
# OUTPUTS
# ============================================================================

Outputs:
  InstanceId:
    Description: ID de la instancia EC2 de desarrollo
    Value: !Ref DevelopmentInstance
    Export:
      Name: !Sub "${ProjectPrefix}-DevInstanceId"

  PublicIP:
    Description: IP pÃºblica de la instancia (usar para SSH)
    Value: !GetAtt DevelopmentInstance.PublicIp

  PublicDNS:
    Description: DNS pÃºblico de la instancia
    Value: !GetAtt DevelopmentInstance.PublicDnsName

  SSHCommand:
    Description: Comando para conectar por SSH
    Value: !Sub "ssh -i ${KeyName}.pem ec2-user@${DevelopmentInstance.PublicIp}"

  AccessURL:
    Description: URL para acceder a la aplicaciÃ³n en desarrollo (puerto 8080)
    Value: !Sub "http://${DevelopmentInstance.PublicIp}:8080"

  Instructions:
    Description: Instrucciones rÃ¡pidas de uso
    Value: |
      PASOS DESPUÃ‰S DE CONECTAR:
      1. Leer instrucciones: cat ~/README.txt
      2. Ir al directorio: cd ~/aquasense
      3. Copiar archivos de la aplicaciÃ³n
      4. Construir imagen: docker build -t aquasense:dev .
      5. Probar localmente: docker run -p 8080:8080 aquasense:dev
      6. Subir a ECR cuando estÃ© listo
      7. ELIMINAR esta instancia despuÃ©s del desarrollo

  ImportantNote:
    Description: Nota importante sobre costos
    Value: |
      âš ï¸  IMPORTANTE: Esta instancia genera costos mientras estÃ¡ en ejecuciÃ³n.
      âš ï¸  Eliminar el stack despuÃ©s del desarrollo:
          aws cloudformation delete-stack --stack-name NOMBRE_DEL_STACK --region us-east-1
